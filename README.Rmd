---
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# msgraphr

> NOTE: This package is quite raw. It's a shell of some functions that work for 
my short-term needse but could use polishing. `msgraphr` is posted for public 
consumption in the hope that it may be of use to some. I'm time-blocked on 
putting much effort into this right now. PRs are **most** welcome.

**msgraphr** is a minimal R wrapper of the SharePoint Online (Office 365) 
APIs, aiming to allow R users to pull down list information as dataframes for 
local analysis. Liberate your data from SharePoint!

## Installation


`devtools::install_github("davidski/msgraphr")`

## Authentication

* Create an application at https://apps.dev.microsoft.com with the following fields:
  + `Name` Name of your MS Graph app e.g. `msgraphr_query`
  + Take note of the `Application Id`, this will be your `client_id`
  + Generate an application secret and note the value as the `Client Secret`
  + Add a Platform and select `Web`.
    + `Allow Implicit Flow`: Unchecked
    + `Redirect URLs`: `http://localhost:1410`
  + Under Microsoft Graph Permissions specify the scope for which you wish to grant access
  
* (OPTIONAL, BUT RECOMMENDED) Set the `MSGRAPH_PAT` environment variable to a 
  file location on disk for `msgraphr` to cache the Oauth2.0 token. Defaults 
  to the current working directory.

* To perform the initial authentication.
  ```
  msgraph_auth(client_id = "REDACTED", 
               client_secret = "REDACTED" )
  ```
  
### Scope used

* `msgraphr` requests the following access scopes:
  + `User` and `Sites.Read.All` for SharePoint online read acees
  + `offline_user` so that tokens may be auto-refreshed without further user action

## Usage

```{r example, eval = FALSE}
library(tidyverse)
library(msgraphr)

# auth
token <- msgraph_auth()

# list all the sites to which you have accesss
get_sites(search = "", token) %>% head(1) %>% pull(id) -> my_site

# list all the lists on that site
get_lists(site_id = my_site, token) %>% head(1) %>% pull(id) -> my_list

# fetch all the entries on that list
get_list_entries(site_id = my_site, list_id = my_list, token)

# go forth and do amazing things!
```

## References

See the [MS Graph](https://developer.microsoft.com/en-us/graph/docs/concepts/overview) API documentation.

## Contributing

Please note that this project is released with a [Contributor Code of Conduct](CONDUCT.md). By participating in this project you agree to abide by its terms.

## License

The [MIT License](LICENSE) applies.
